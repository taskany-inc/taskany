generator client {
  provider = "prisma-client-js"
}

generator typegraphql {
  provider = "typegraphql-prisma"
  output   = "../src/@generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("TASKANY_DATABASE_URL")
}

model Account {
  id                Int      @id @default(autoincrement())
  user              User     @relation(fields: [id], references: [id])
  providerType      String   @map(name: "provider_type")
  providerId        String   @map(name: "provider_id")
  providerAccountId Int      @map(name: "provider_account_id")
  createdAt         DateTime @default(now()) @map(name: "created_at")
  updatedAt         DateTime @default(now()) @map(name: "updated_at")


  @@index([providerAccountId], name: "providerAccountId")
  @@index([providerId], name: "providerId")
  @@map(name: "accounts")
}

model User {
  id                 Int            @id @default(autoincrement())
  name               String?
  email              String?        @unique
  emailVerified      DateTime?      @map(name: "email_verified")
  image              String?
  accounts           Account[]
  createdQueues      Queue[]        @relation("createdQueues")
  organizations      Organization[] @relation("organizations")
  orgSubscriptions   Organization[] @relation("orgSubscriptions")
  issues             Issue[]        @relation("issues")
  issueSubscriptions Issue[]        @relation("issueSubscriptions")
  posts              Post[]         @relation("posts")
  postSubscriptions  Post[]         @relation("postSubscriptions")
  comments           Comment[]      @relation("comments")
  reactions          Reaction[]     @relation("reactions")
  createdAt          DateTime       @default(now()) @map(name: "created_at")
  updatedAt          DateTime       @default(now()) @map(name: "updated_at")

  @@map(name: "users")
}

model Queue {
  id          Int      @id @default(autoincrement())
  key         String   @unique
  title       String?
  description String?
  createdBy   User     @relation("createdQueues", fields: [creatorId], references: [id])
  creatorId   Int
  issues      Issue[]  @relation("queueIssues")
  createdAt   DateTime @default(now()) @map(name: "created_at")
  updatedAt   DateTime @default(now()) @map(name: "updated_at")

  @@map(name: "queues")
}

model Issue {
  id          Int        @id @default(autoincrement())
  key         String     @unique
  title       String
  description String?
  createdBy   User       @relation("issues", fields: [creatorId], references: [id])
  creatorId   Int
  queue       Queue      @relation("queueIssues", fields: [queueId], references: [id])
  queueId     Int
  reactions   Reaction[] @relation("issueReactions")
  comments    Comment[]  @relation("issueComments")
  subscribers User[]     @relation("issueSubscriptions")
  createdAt   DateTime   @default(now()) @map(name: "created_at")
  updatedAt   DateTime   @default(now()) @map(name: "updated_at")
  //   kind      IssueKind @relation(name: "kind", fields: [id], references: [id])

  @@map(name: "issues")
}

model Organization {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  title       String?
  description String?
  createdBy   User     @relation("organizations", fields: [creatorId], references: [id])
  creatorId   Int
  posts       Post[]   @relation("organizationPosts")
  subscribers User[]   @relation("orgSubscriptions")
  createdAt   DateTime @default(now()) @map(name: "created_at")
  updatedAt   DateTime @default(now()) @map(name: "updated_at")

  @@map(name: "organizations")
}

model Post {
  id             Int          @id @default(autoincrement())
  title          String
  description    String
  published      DateTime?
  createdBy      User         @relation("posts", fields: [creatorId], references: [id])
  creatorId      Int
  organization   Organization @relation("organizationPosts", fields: [organizationId], references: [id])
  organizationId Int
  reactions      Reaction[]   @relation("postReactions")
  comments       Comment[]    @relation("postComments")
  subscribers    User[]       @relation("postSubscriptions")
  createdAt      DateTime     @default(now()) @map(name: "created_at")
  updatedAt      DateTime     @default(now()) @map(name: "updated_at")

  @@map(name: "posts")
}

model Comment {
  id          Int        @id @default(autoincrement())
  description String
  createdBy   User       @relation("comments", fields: [creatorId], references: [id])
  creatorId   Int
  post        Post?      @relation("postComments", fields: [postId], references: [id])
  postId      Int?
  issue       Issue?     @relation("issueComments", fields: [issueId], references: [id])
  issueId     Int?
  reactions   Reaction[] @relation("commentReactions")
  createdAt   DateTime   @default(now()) @map(name: "created_at")
  updatedAt   DateTime   @default(now()) @map(name: "updated_at")

  @@map(name: "comments")
}

model Reaction {
  id        Int      @id @default(autoincrement())
  kind      String
  createdBy User     @relation("reactions", fields: [creatorId], references: [id])
  creatorId Int
  post      Post?    @relation("postReactions", fields: [postId], references: [id])
  postId    Int?
  issue     Issue?   @relation("issueReactions", fields: [issueId], references: [id])
  issueId   Int?
  comment   Comment? @relation("commentReactions", fields: [commentId], references: [id])
  commentId Int?
  createdAt DateTime @default(now()) @map(name: "created_at")
  updatedAt DateTime @default(now()) @map(name: "updated_at")

  @@map(name: "reactions")
}

// model IssueKind {
//   id        Int      @id @default(autoincrement())
//   kind      String   @unique
//   issues    Issue[]  @relation(name: "kind")
//   fields    Field[]  @relation(name: "fields")
//   createdAt DateTime @default(now()) @map(name: "created_at")
//   updatedAt DateTime @default(now()) @map(name: "updated_at")

//   @@map(name: "issueKinds")
// }

// model Field {
//   id         Int         @id @default(autoincrement())
//   name       String      @unique
//   issueKinds IssueKind[] @relation(name: "fields")
//   createdAt  DateTime    @default(now()) @map(name: "created_at")
//   updatedAt  DateTime    @default(now()) @map(name: "updated_at")

//   @@map(name: "fields")
// }
